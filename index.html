<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Buzzer Multiplayer</title>
  <style>
    body { font-family: Arial; text-align: center; background: #f0f0f0; margin: 0; padding: 20px; }
    .container { max-width: 1000px; margin: auto; }
    .buzzer-row { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
    .buzzer-container { margin: 10px; display: flex; flex-direction: column; align-items: center; }
    .buzzer { padding: 20px; font-size: 20px; background: #555; color: white; border: none; border-radius: 10px; width: 120px; }
    .disabled { background: #aaa !important; cursor: not-allowed; }
    .score-input, .name-input { margin-top: 5px; padding: 5px; font-size: 16px; width: 120px; text-align: center; }
    #status { font-size: 24px; margin: 20px 0; font-weight: bold; }
    #reset { margin-top: 20px; padding: 10px 30px; font-size: 16px; background: #222; color: white; border: none; border-radius: 5px; cursor: pointer; }
    #password-screen, #game-screen { display: none; }
  </style>
</head>
<body>
  <div id="password-screen" class="container">
    <h1>Login</h1>
    <input type="text" id="name-input" placeholder="Enter player name or 'host'"><br><br>
    <input type="password" id="password-input" placeholder="Enter password">
    <button id="auth-button">Login</button>
    <div id="auth-error" style="color:red; margin-top: 10px;"></div>
  </div>

  <div id="game-screen" class="container">
    <h1 id="status">Ready</h1>
    <div id="host-controls" style="display:none;">
      <label>Number of Players:</label>
      <input type="number" id="players-input" min="2" max="8" value="4">
    </div>
    <div id="buzzer-row" class="buzzer-row"></div>
    <button id="reset">Reset</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCnZ3AjNQ4BFkNch5ybCkYv2TT-GwHzU3U",
      authDomain: "oliver-s-quiz-game.firebaseapp.com",
      databaseURL: "https://oliver-s-quiz-game-default-rtdb.firebaseio.com",
      projectId: "oliver-s-quiz-game",
      storageBucket: "oliver-s-quiz-game.appspot.com",
      messagingSenderId: "723449396892",
      appId: "1:723449396892:web:ef7f27418c17ea17092431"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let isHost = false;
    let playerName = '';
    let isBuzzerActive = true;

    const gameStatus = document.getElementById('status');
    const resetButton = document.getElementById('reset');
    const buzzerRow = document.getElementById('buzzer-row');
    const hostControls = document.getElementById('host-controls');
    const playersInput = document.getElementById('players-input');
    const passwordScreen = document.getElementById('password-screen');
    const gameScreen = document.getElementById('game-screen');
    const authError = document.getElementById('auth-error');

    const buzzerFrequencies = [440, 523.25, 659.25, 880, 987.77, 1108.73, 1318.51, 1760];

    function playBeep(freq, duration) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.type = 'sine';
      osc.frequency.value = freq;
      gain.gain.value = 0.5;
      osc.start();
      osc.stop(ctx.currentTime + duration);
    }

    function renderPlayers(players) {
      buzzerRow.innerHTML = '';
      Object.entries(players).forEach(([name, data], i) => {
        const container = document.createElement('div');
        container.className = 'buzzer-container';

        const nameInput = document.createElement('input');
        nameInput.className = 'name-input';
        nameInput.value = name;
        nameInput.disabled = true;

        const buzzer = document.createElement('button');
        buzzer.className = 'buzzer';
        buzzer.textContent = name;
        buzzer.dataset.name = name;

        const score = document.createElement('input');
        score.type = 'number';
        score.value = data.score || 0;
        score.className = 'score-input';
        score.readOnly = true;

        buzzer.addEventListener('click', () => {
          if (!isBuzzerActive || playerName !== name) return;
          db.ref('buzzed').once('value').then(snap => {
            if (!snap.exists()) {
              db.ref('buzzed').set({ name });
              db.ref(`players/${name}/score`).transaction(score => (score || 0) + 1000);
            }
          });
        });

        container.appendChild(nameInput);
        container.appendChild(buzzer);
        container.appendChild(score);
        buzzerRow.appendChild(container);
      });
    }

    function listenToGame() {
      db.ref('players').on('value', snap => {
        const players = snap.val();
        if (players) renderPlayers(players);
      });

      db.ref('buzzed').on('value', snap => {
        const data = snap.val();
        if (data) {
          gameStatus.textContent = `${data.name} buzzed first!`;
          isBuzzerActive = false;
        } else {
          gameStatus.textContent = 'Ready';
          isBuzzerActive = true;
        }
      });
    }

    document.getElementById('auth-button').onclick = () => {
      playerName = document.getElementById('name-input').value.trim();
      const pass = document.getElementById('password-input').value;

      if (!playerName) {
        authError.textContent = 'Please enter your name';
        return;
      }

      if (pass === 'quizmaster123') {
        isHost = true;
        gameScreen.style.display = 'block';
        passwordScreen.style.display = 'none';
        hostControls.style.display = 'block';
        db.ref('players').set({});
      } else {
        db.ref(`players/${playerName}`).once('value').then(snap => {
          if (snap.exists()) {
            gameScreen.style.display = 'block';
            passwordScreen.style.display = 'none';
          } else {
            authError.textContent = 'Name not found. Ask host to set players first.';
          }
        });
      }

      listenToGame();
    };

    playersInput.addEventListener('input', () => {
      if (!isHost) return;
      const count = Math.max(2, Math.min(8, parseInt(playersInput.value)));
      const players = {};
      for (let i = 0; i < count; i++) {
        players[`Player ${i + 1}`] = { score: 0 };
      }
      db.ref('players').set(players);
    });

    resetButton.onclick = () => db.ref('buzzed').remove();
  </script>
</body>
</html>
