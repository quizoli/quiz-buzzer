<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Join Quiz Buzzer</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 30px;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
    }
    #buzz-button {
      width: 200px;
      height: 100px;
      font-size: 24px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #buzz-button:disabled {
      background-color: #ccc;
    }
    #leaderboard {
      margin-top: 40px;
      text-align: left;
      display: inline-block;
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    #quiz-timer {
      font-size: 24px;
      margin: 20px;
    }
  </style>
</head>
<body>
  <div id="join-screen">
    <h2>Enter Your Name to Join</h2>
    <input type="text" id="player-name" placeholder="Your name" />
    <button onclick="joinGame()">Join</button>
  </div>

  <div id="game-screen" class="hidden">
    <h2 id="status">Ready</h2>
    <button id="buzz-button" onclick="buzz()">Buzz!</button><br>
    <button onclick="resetBuzz()">Reset (Quizmaster only)</button>
    <div id="quiz-timer">00:00</div>
    <div id="leaderboard">
      <h3>Leaderboard</h3>
      <ul id="score-list"></ul>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCnZ3AjNQ4BFkNch5ybCkYv2TT-GwHzU3U",
      authDomain: "oliver-s-quiz-game.firebaseapp.com",
      databaseURL: "https://oliver-s-quiz-game-default-rtdb.firebaseio.com",
      projectId: "oliver-s-quiz-game",
      storageBucket: "oliver-s-quiz-game.appspot.com",
      messagingSenderId: "723449396892",
      appId: "1:723449396892:web:ef7f27418c17ea17092431"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const joinScreen = document.getElementById("join-screen");
    const gameScreen = document.getElementById("game-screen");
    const playerNameInput = document.getElementById("player-name");
    const buzzButton = document.getElementById("buzz-button");
    const status = document.getElementById("status");
    const quizTimer = document.getElementById("quiz-timer");
    const scoreList = document.getElementById("score-list");

    let playerName = "";
    let timer = 0;
    let timerInterval;

    function joinGame() {
      playerName = playerNameInput.value.trim();
      if (!playerName) {
        alert("Please enter your name");
        return;
      }
      joinScreen.classList.add("hidden");
      gameScreen.classList.remove("hidden");
      db.ref(`players/${playerName}`).set({ score: 0 });
    }

    function buzz() {
      db.ref("buzzed").get().then(snapshot => {
        if (!snapshot.exists()) {
          db.ref("buzzed").set({ player: playerName });
          db.ref(`players/${playerName}/score`).get().then(scoreSnap => {
            const currentScore = scoreSnap.val() || 0;
            db.ref(`players/${playerName}/score`).set(currentScore + 1000);
          });
        }
      });
    }

    function resetBuzz() {
      db.ref("buzzed").remove();
      clearInterval(timerInterval);
      timer = 0;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timer++;
        updateTimerDisplay();
      }, 1000);
    }

    db.ref("buzzed").on("value", snapshot => {
      const data = snapshot.val();
      if (data) {
        status.textContent = `${data.player} buzzed first!`;
        buzzButton.disabled = true;
        playBeep();
      } else {
        status.textContent = "Ready";
        buzzButton.disabled = false;
      }
    });

    db.ref("players").on("value", snapshot => {
      const players = snapshot.val() || {};
      scoreList.innerHTML = "";
      Object.entries(players).sort((a,b) => b[1].score - a[1].score).forEach(([name, info]) => {
        const li = document.createElement("li");
        li.textContent = `${name}: ${info.score}`;
        scoreList.appendChild(li);
      });
    });

    function updateTimerDisplay() {
      const minutes = String(Math.floor(timer / 60)).padStart(2, '0');
      const seconds = String(timer % 60).padStart(2, '0');
      quizTimer.textContent = `${minutes}:${seconds}`;
    }

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playBeep() {
      const now = audioCtx.currentTime;
      const osc1 = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc1.connect(gain);
      osc2.connect(gain);
      gain.connect(audioCtx.destination);

      osc1.frequency.setValueAtTime(440, now);
      osc2.frequency.setValueAtTime(660, now + 0.2);
      osc1.start(now);
      osc1.stop(now + 0.2);
      osc2.start(now + 0.2);
      osc2.stop(now + 0.4);

      gain.gain.setValueAtTime(0.5, now);
    }
  </script>
</body>
</html>
